<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Kaplan Trainingsplan Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --card: #020617;
      --accent: #4f46e5;
      --accent-soft: rgba(79, 70, 229, 0.2);
      --accent-strong: rgba(79, 70, 229, 0.35);
      --text: #f9fafb;
      --text-soft: #9ca3af;
      --border: rgba(148, 163, 184, 0.4);
      --radius-lg: 20px;
      --radius-md: 12px;
      --shadow-soft: 0 20px 45px rgba(15, 23, 42, 0.9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #000 65%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 20px 12px 26px;
    }

    .app-shell {
      width: 100%;
      max-width: 640px;
      border-radius: 28px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.99), rgba(15, 23, 42, 0.98));
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.3);
      padding: 16px 14px 14px;
      position: relative;
      overflow: hidden;
    }

    .glow {
      position: absolute;
      inset: -100px;
      background:
        radial-gradient(circle at 0 0, rgba(79, 70, 229, 0.38), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(14, 165, 233, 0.3), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      z-index: 0;
    }

    .app-inner {
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      margin-bottom: 10px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 42px;
      height: 42px;
      border-radius: 16px;
      padding: 2px;
      background: conic-gradient(from 210deg, #4f46e5, #06b6d4, #22c55e, #f97316, #4f46e5);
    }

    .brand-logo-inner {
      width: 100%;
      height: 100%;
      border-radius: 14px;
      background: radial-gradient(circle at 25% 0, #1f2937 0, #020617 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 1px;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .brand-title {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .brand-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .trainer-tag {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.94);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      white-space: nowrap;
      max-width: 150px;
    }

    .trainer-tag span {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .trainer-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.35);
    }

    .hint {
      font-size: 11px;
      color: var(--text-soft);
      margin: 4px 2px 10px;
    }

    .form-card {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
      border-radius: var(--radius-lg);
      padding: 10px 11px 10px;
      border: 1px solid var(--border);
      margin-bottom: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 10px;
    }

    @media (max-width: 520px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 11px;
      color: var(--text-soft);
    }

    select,
    input {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text);
      font-size: 12px;
      padding: 7px 10px;
      outline: none;
    }

    select:focus,
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 8px 13px;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.94);
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      border-color: transparent;
      color: #e5e7eb;
      font-weight: 500;
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .btn:active,
    .btn-primary:active {
      transform: translateY(1px);
    }

    .btn span.icon {
      font-size: 14px;
    }

    .tagline {
      font-size: 10px;
      color: var(--text-soft);
      opacity: 0.9;
    }

    .output-card {
      background: rgba(15, 23, 42, 0.98);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 11px 11px 10px;
      margin-top: 10px;
      max-height: 430px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .output-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .output-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .output-meta {
      font-size: 11px;
      color: var(--text-soft);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .chip {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.96);
    }

    .copy-btn {
      font-size: 11px;
      padding: 6px 10px;
    }

    .output-body {
      margin-top: 4px;
      padding-top: 5px;
      border-top: 1px dashed rgba(148, 163, 184, 0.3);
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: rgba(148, 163, 184, 0.6) transparent;
    }

    .output-body::-webkit-scrollbar {
      width: 5px;
    }

    .output-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .output-body::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.6);
      border-radius: 999px;
    }

    .section {
      padding: 7px 6px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
      margin-bottom: 6px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .section-title {
      font-weight: 600;
    }

    .section-time {
      font-size: 11px;
      color: var(--text-soft);
    }

    .exercise {
      font-size: 11px;
      margin-bottom: 6px;
    }

    .exercise-title {
      font-weight: 600;
      margin-bottom: 1px;
    }

    .exercise-details {
      color: var(--text-soft);
      line-height: 1.35;
    }

    .exercise-footer {
      margin-top: 3px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px 8px;
      align-items: center;
    }

    .exercise-link {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .exercise-link span.icon {
      font-size: 12px;
    }

    .exercise-source {
      font-size: 9px;
      color: var(--text-soft);
      opacity: 0.9;
    }

    .small {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .empty {
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
      padding: 12px 4px 4px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="glow"></div>
    <div class="app-inner">
      <header>
        <div class="brand">
          <div class="brand-logo"><div class="brand-logo-inner">K</div></div>
          <div class="brand-text">
            <div class="brand-title">Kaplan Trainingsplan</div>
            <div class="brand-sub">Generator f√ºr Jugendfu√üball</div>
          </div>
        </div>
        <button class="trainer-tag" id="trainerButton" type="button">
          <div class="trainer-dot"></div>
          <span id="trainerNameLabel">Trainer</span>
        </button>
      </header>

      <p class="hint">
        Du w√§hlst oben ein ‚Äì der Plan erstellt automatisch √úbungen. Unter jeder √úbung kannst du passende Varianten mit Bildern direkt auf easy2coach √∂ffnen.
      </p>

      <section class="form-card">
        <div class="form-grid">
          <div class="field">
            <label>Altersklasse</label>
            <select id="ageGroup">
              <option value="u8u9">U8 / U9</option>
              <option value="u10u11">U10 / U11</option>
              <option value="u12u13" selected>U12 / U13</option>
              <option value="u14plus">U14 und √§lter</option>
            </select>
          </div>

          <div class="field">
            <label>Trainingsdauer</label>
            <select id="duration">
              <option value="60" selected>60 Minuten</option>
              <option value="75">75 Minuten</option>
              <option value="90">90 Minuten</option>
            </select>
          </div>

          <div class="field">
            <label>Schwerpunkt</label>
            <select id="focus">
              <option value="technik" selected>Technik & Dribbling</option>
              <option value="passspiel">Passspiel & Kombination</option>
              <option value="abschluss">Torabschluss</option>
              <option value="spielform">Spielformen & Taktik</option>
              <option value="athletik">Athletik & Koordination</option>
              <option value="gemischt">Gemischt (Allround)</option>
            </select>
          </div>

          <div class="field">
            <label>Intensit√§t</label>
            <select id="intensity">
              <option value="locker">Locker</option>
              <option value="mittel" selected>Mittel</option>
              <option value="hoch">Hoch</option>
            </select>
          </div>

          <div class="field">
            <label>Spieleranzahl</label>
            <input id="players" type="number" placeholder="z.B. 12" />
          </div>

          <div class="field">
            <label>Notiz</label>
            <input id="note" type="text" placeholder="z.B. Turniervorbereitung" />
          </div>
        </div>

        <div class="actions">
          <button id="generateButton" class="btn btn-primary">
            <span class="icon">‚öΩÔ∏è</span>Plan erstellen
          </button>
          <div class="tagline">Struktur: Warm-Up ¬∑ Technik ¬∑ Spielform ¬∑ Abschluss ¬∑ (+ Athletik)</div>
        </div>
      </section>

      <section class="output-card">
        <div class="output-header">
          <div class="output-title-block">
            <div class="output-title">Aktueller Plan</div>
            <div class="output-meta" id="outputMeta">Noch kein Plan erstellt.</div>
            <div class="chip-row" id="chipRow"></div>
          </div>
          <button id="copyButton" class="btn copy-btn">
            <span class="icon">üìã</span> Kopieren
          </button>
        </div>

        <div class="output-body" id="planOutput">
          <div class="empty">Erstelle zuerst einen Plan.</div>
        </div>
      </section>

      <p class="small">Hinweis: easy2coach-Links √∂ffnen die √úbungsdatenbank mit Bildern/Grafiken. Die Beschreibungen hier sind deine Basis√ºbungen.</p>
    </div>
  </div>

  <script>
    // --- Trainername speichern ---
    const trainerButton = document.getElementById("trainerButton");
    const trainerNameLabel = document.getElementById("trainerNameLabel");

    function loadTrainerName() {
      const stored = localStorage.getItem("kaplan_trainer_name");
      trainerNameLabel.textContent = stored && stored.trim() ? stored : "Trainer";
    }
    loadTrainerName();

    trainerButton.addEventListener("click", () => {
      const current = localStorage.getItem("kaplan_trainer_name") || "";
      const name = prompt("Name anzeigen als Trainer:", current);
      if (name !== null) {
        const t = name.trim();
        if (t.length > 0) {
          localStorage.setItem("kaplan_trainer_name", t);
          trainerNameLabel.textContent = t;
        } else {
          localStorage.removeItem("kaplan_trainer_name");
          trainerNameLabel.textContent = "Trainer";
        }
      }
    });

    // --- "Datenbank" der √úbungen (von mir formuliert, nicht aus e2c kopiert) ---
    // section: warmup | technik | spielform | abschluss | athletik
    // focusTags: technik, passspiel, abschluss, spielform, athletik, gemischt
    const DRILLS = [
      // Warm-Up
      {
        section: "warmup",
        title: "Lauf-ABC mit Ball",
        minutes: 8,
        focusTags: ["gemischt", "athletik"],
        description: "Locker einlaufen, dann Kniehebelauf, Anfersen, Seitgalopp ‚Äì jeweils zuerst ohne, dann mit Ball am Fu√ü. Letzte 2 Minuten freies Dribbling mit Tempowechsel."
      },
      {
        section: "warmup",
        title: "Fangen mit Ball (J√§ger & Hasen)",
        minutes: 10,
        focusTags: ["technik", "gemischt"],
        description: "Alle bis auf 1‚Äì2 Spieler haben einen Ball. Die F√§nger ohne Ball versuchen abzuschlagen. Nach Abschlag 5 schnelle Kontakte um ein H√ºtchen und weiter geht‚Äôs. H√§ufige Rollenwechsel."
      },
      {
        section: "warmup",
        title: "Dribbel-Slalom",
        minutes: 10,
        focusTags: ["technik"],
        description: "Slalomlinien mit H√ºtchen aufbauen. Viele Ballkontakte, beide F√º√üe, Richtungswechsel, auf Kommando Sprint durch. Perfekt f√ºr 6‚Äì14 Spieler in kleinen Gruppen."
      },
      {
        section: "warmup",
        title: "Kettenfangen",
        minutes: 8,
        focusTags: ["athletik", "gemischt"],
        description: "Zwei F√§nger bilden eine Kette (Hand in Hand). Wird ein Spieler gefangen, schlie√üt er sich an. Sehr aktiv, kurze Runden, ideal als Einstieg."
      },

      // Technik / Passspiel / Abschluss
      {
        section: "technik",
        title: "Coerver-Ballkontrolle",
        minutes: 12,
        focusTags: ["technik"],
        description: "In Reihen oder kleinen Gruppen: Innen-Au√üen, Sohlenzieher, √úbersteiger, Richtungswechsel. Viele Wiederholungen, beidf√º√üig, nach und nach Tempo steigern."
      },
      {
        section: "technik",
        title: "Rondo 4v1 / 5v2",
        minutes: 12,
        focusTags: ["passspiel", "technik"],
        description: "Quadrat mit 4‚Äì5 Spielern au√üen, 1‚Äì2 Spielern in der Mitte. Max. 2 Kontakte, flache P√§sse, offener K√∂rper. 10 P√§sse in Folge = 1 Punkt."
      },
      {
        section: "technik",
        title: "Doppelpass & Tiefenlauf",
        minutes: 10,
        focusTags: ["passspiel", "abschluss"],
        description: "Passgeber spielt Wandpass, erh√§lt den Ball klatsch zur√ºck und steckt in die Tiefe durch. Der Tiefenl√§ufer nimmt mit und schlie√üt auf Minitor oder Gro√ütor ab."
      },
      {
        section: "technik",
        title: "Abschluss nach Dribbling",
        minutes: 12,
        focusTags: ["abschluss", "technik"],
        description: "Spieler dribbeln von leicht seitlicher Position Richtung Tor, machen vor dem Abschluss eine Finte (z.B. √úbersteiger) und schlie√üen mit Vollspann ab."
      },

      // Spielformen
      {
        section: "spielform",
        title: "4-gegen-4 mit Zonen",
        minutes: 15,
        focusTags: ["spielform", "passspiel"],
        description: "Feld in 3 Zonen (Aufbau ‚Äì Mitte ‚Äì Angriff) teilen. In Phase 1 muss der Ball jede Zone durchlaufen. F√∂rdert Raumaufteilung und Spielaufbau."
      },
      {
        section: "spielform",
        title: "√úberzahlspiel 3v2 / 4v3",
        minutes: 12,
        focusTags: ["spielform", "abschluss"],
        description: "Angreifer starten aus dem Mittelfeld in √úberzahl auf das Tor. Nach Ballgewinn oder Abschluss n√§chster Angriff. Fokus: schnelles Ausspielen der √úberzahl."
      },
      {
        section: "spielform",
        title: "Konterspiel mit Kontertoren",
        minutes: 15,
        focusTags: ["spielform", "athletik"],
        description: "Zwei Teams, Spielfeld lang. Nach Ballgewinn sofort in die andere Richtung kontern, auf Minitore abschlie√üen. Zeitlimit pro Angriff, um Tempo hochzuhalten."
      },

      // Abschlussspiel
      {
        section: "abschluss",
        title: "Freies Spiel mit Coaching-Ziel",
        minutes: 18,
        focusTags: ["gemischt", "spielform"],
        description: "Normales Spiel (z.B. 6v6) mit klarem Coaching-Ziel: z.B. Breite halten, Spielverlagerung oder mutig abschlie√üen. Nach 5‚Äì6 Minuten kurzes Feedback."
      },
      {
        section: "abschluss",
        title: "Funino 3-gegen-3 auf 4 Tore",
        minutes: 16,
        focusTags: ["technik", "abschluss"],
        description: "Kleine Felder mit 4 Minitoren. Tore z√§hlen nur nach Angriff √ºber die Au√üen. F√∂rdert 1v1, Entscheidungsverhalten und schnelles Umschalten."
      },
      {
        section: "abschluss",
        title: "Mini-Turnier (Champions League)",
        minutes: 18,
        focusTags: ["gemischt", "spielform"],
        description: "3‚Äì4 Teams √† 3‚Äì5 Spieler. Kurze Spiele (z.B. 5 Minuten), Punkte z√§hlen. Ideal, um am Ende Wettkampfcharakter reinzubringen."
      },

      // Athletik
      {
        section: "athletik",
        title: "Koordinationsleiter + Sprints",
        minutes: 10,
        focusTags: ["athletik"],
        description: "Stationen mit Leiter (beidbeinig, einbeinig, seitlich) und kurzen Sprints. Technik sauber, Pausen zwischen den L√§ufen, lieber Qualit√§t als reine Menge."
      },
      {
        section: "athletik",
        title: "Stabi-Zirkel",
        minutes: 10,
        focusTags: ["athletik"],
        description: "4‚Äì5 Stationen: Unterarmst√ºtz, Seitst√ºtz, Kniebeugen, Ausfallschritte, Sprung-Landungen. 30‚Äì40 Sek. Belastung, 20 Sek. Pause."
      },
      {
        section: "athletik",
        title: "Sprintduelle mit Ball",
        minutes: 8,
        focusTags: ["athletik", "technik"],
        description: "1v1 oder 2v2 Sprint mit Ball auf Minitore oder Linien. Wer zuerst abschlie√üt, bekommt den Punkt. Ideal am Ende einer Technikphase."
      }
    ];

    function getE2CUrlForDrill(drill) {
      // einfache, allgemeine Links zur e2c-√úbungsdatenbank
      // (du kannst sp√§ter selbst feinere Filter-/Such-URLS einsetzen)
      return "https://www.easy2coach.net/de/fussball-uebungsdatenbank_pre.html";
    }

    // Filtert √úbungen passend zur Sektion und Schwerpunkt
    function filterDrills(section, focus) {
      return DRILLS.filter(d =>
        d.section === section &&
        (d.focusTags.includes(focus) || d.focusTags.includes("gemischt"))
      );
    }

    function pickRandom(drills, count) {
      const copy = drills.slice();
      const chosen = [];
      while (copy.length && chosen.length < count) {
        const idx = Math.floor(Math.random() * copy.length);
        chosen.push(copy.splice(idx, 1)[0]);
      }
      return chosen;
    }

    // Zeitaufteilung & welche Bl√∂cke
    function buildPlanStructure(duration, focus, intensity) {
      let warmup, technik, spielform, abschluss, athletik = 0;

      duration = Number(duration);

      if (duration === 60) {
        warmup = 10; technik = 15; spielform = 15; abschluss = 15;
        athletik = intensity === "hoch" ? 5 : intensity === "mittel" ? 5 : 0;
      } else if (duration === 75) {
        warmup = 12; technik = 18; spielform = 20; abschluss = 18;
        athletik = intensity === "hoch" ? 7 : intensity === "mittel" ? 5 : 0;
      } else {
        warmup = 15; technik = 20; spielform = 25; abschluss = 20;
        athletik = intensity === "hoch" ? 10 : intensity === "mittel" ? 8 : 5;
      }

      const blocks = [];

      blocks.push({
        key: "warmup",
        label: "Warm-Up",
        minutes: warmup,
        drills: pickRandom(filterDrills("warmup", focus), 2)
      });

      blocks.push({
        key: "technik",
        label: "Technik / Schulung",
        minutes: technik,
        drills: pickRandom(filterDrills("technik", focus), 2)
      });

      blocks.push({
        key: "spielform",
        label: "Spielformen / Anwendung",
        minutes: spielform,
        drills: pickRandom(filterDrills("spielform", focus), 2)
      });

      blocks.push({
        key: "abschluss",
        label: "Abschlussspiel",
        minutes: abschluss,
        drills: pickRandom(filterDrills("abschluss", focus), 1)
      });

      if (athletik > 0) {
        blocks.push({
          key: "athletik",
          label: "Athletik / Stabi",
          minutes: athletik,
          drills: pickRandom(filterDrills("athletik", focus), 1)
        });
      }

      return blocks;
    }

    function formatAgeGroup(v) {
      return {u8u9:"U8/U9",u10u11:"U10/U11",u12u13:"U12/U13",u14plus:"U14+"}[v] || v;
    }

    function formatFocus(v) {
      return {
        technik:"Technik & Dribbling",
        passspiel:"Passspiel & Kombination",
        abschluss:"Torabschluss",
        spielform:"Spielformen & Taktik",
        athletik:"Athletik & Koordination",
        gemischt:"Gemischt (Allround)"
      }[v] || v;
    }

    function formatIntensity(v){
      return {locker:"locker",mittel:"mittel",hoch:"hoch"}[v] || v;
    }

    const generateButton = document.getElementById("generateButton");
    const planOutput = document.getElementById("planOutput");
    const outputMeta = document.getElementById("outputMeta");
    const chipRow = document.getElementById("chipRow");
    const copyButton = document.getElementById("copyButton");

    let lastPlanText = "";

    function buildTextPlan(meta, blocks) {
      const lines = [];
      lines.push(`Trainingsplan ‚Äì ${meta.date}`);
      lines.push(`Altersklasse: ${meta.ageGroup}`);
      lines.push(`Dauer: ${meta.duration} Min ¬∑ Schwerpunkt: ${meta.focus} ¬∑ Intensit√§t: ${meta.intensity}`);
      if (meta.players) lines.push(`Spieler: ~${meta.players}`);
      if (meta.note) lines.push(`Hinweis: ${meta.note}`);
      if (meta.trainer) lines.push(`Trainer: ${meta.trainer}`);
      lines.push("");

      blocks.forEach((b,i)=>{
        lines.push(`${i+1}. ${b.label} (${b.minutes} Min)`);
        b.drills.forEach((d,j)=>{
          lines.push(`   ${String.fromCharCode(97 + j)}) ${d.title}`);
          lines.push(`      ${d.description}`);
        });
        lines.push("");
      });

      lines.push("Weitere Varianten mit Bildern/Grafiken: easy2coach √úbungsdatenbank (https://www.easy2coach.net/de/fussball-uebungsdatenbank_pre.html)");

      return lines.join("\n");
    }

    function renderPlan(meta, blocks) {
      if (!blocks || !blocks.length) {
        planOutput.innerHTML = '<div class="empty">Fehler beim Generieren des Plans.</div>';
        return;
      }

      outputMeta.textContent =
        `${meta.date} ¬∑ ${meta.ageGroup} ¬∑ ${meta.duration} Min ¬∑ ${meta.focus}`;

      chipRow.innerHTML = "";
      const c1 = document.createElement("span");
      c1.className = "chip";
      c1.textContent = `Intensit√§t: ${meta.intensity}`;
      chipRow.appendChild(c1);

      if (meta.players) {
        const c2 = document.createElement("span");
        c2.className = "chip";
        c2.textContent = `Spieler: ~${meta.players}`;
        chipRow.appendChild(c2);
      }
      if (meta.note) {
        const c3 = document.createElement("span");
        c3.className = "chip";
        c3.textContent = meta.note;
        chipRow.appendChild(c3);
      }

      planOutput.innerHTML = "";

      blocks.forEach(block => {
        const section = document.createElement("div");
        section.className = "section";

        const header = document.createElement("div");
        header.className = "section-header";

        const stitle = document.createElement("div");
        stitle.className = "section-title";
        stitle.textContent = block.label;

        const stime = document.createElement("div");
        stime.className = "section-time";
        stime.textContent = `${block.minutes} Min`;

        header.appendChild(stitle);
        header.appendChild(stime);
        section.appendChild(header);

        block.drills.forEach(drill => {
          const ex = document.createElement("div");
          ex.className = "exercise";

          const title = document.createElement("div");
          title.className = "exercise-title";
          title.textContent = drill.title;

          const details = document.createElement("div");
          details.className = "exercise-details";
          details.textContent = drill.description;

          ex.appendChild(title);
          ex.appendChild(details);

          const footer = document.createElement("div");
          footer.className = "exercise-footer";

          const url = getE2CUrlForDrill(drill);
          const link = document.createElement("a");
          link.className = "exercise-link";
          link.href = url;
          link.target = "_blank";
          link.rel = "noopener";
          link.innerHTML = '<span class="icon">üñºÔ∏è</span><span>√úbungen auf easy2coach</span>';

          const src = document.createElement("span");
          src.className = "exercise-source";
          src.textContent = "√ñffnet die easy2coach-√úbungsdatenbank mit passenden √úbungen.";

          footer.appendChild(link);
          footer.appendChild(src);
          ex.appendChild(footer);

          section.appendChild(ex);
        });

        planOutput.appendChild(section);
      });

      lastPlanText = buildTextPlan(meta, blocks);
    }

    generateButton.addEventListener("click", () => {
      const age = document.getElementById("ageGroup").value;
      const dur = document.getElementById("duration").value;
      const focus = document.getElementById("focus").value;
      const intensity = document.getElementById("intensity").value;
      const players = document.getElementById("players").value.trim();
      const note = document.getElementById("note").value.trim();
      const trainer = localStorage.getItem("kaplan_trainer_name") || "";

      const now = new Date();
      const dateStr = now.toLocaleDateString("de-DE", {
        weekday: "short",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });

      const meta = {
        date: dateStr,
        ageGroup: formatAgeGroup(age),
        duration: Number(dur),
        focus: formatFocus(focus),
        intensity: formatIntensity(intensity),
        players: players || "",
        note: note || "",
        trainer: trainer || ""
      };

      const blocks = buildPlanStructure(dur, focus, intensity);
      renderPlan(meta, blocks);
    });

    copyButton.addEventListener("click", async () => {
      if (!lastPlanText) {
        alert("Bitte erst einen Plan erstellen.");
        return;
      }
      try {
        await navigator.clipboard.writeText(lastPlanText);
        alert("Plan in die Zwischenablage kopiert.");
      } catch {
        alert("Kopieren nicht m√∂glich ‚Äì bitte Text manuell markieren.");
      }
    });
  </script>
</body>
</html>
